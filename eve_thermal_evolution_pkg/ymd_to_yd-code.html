<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.4.3 on Thu Jul 05 11:36:30 2012 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>ymd_to_yd.pro (Documentation for C:\Users\Lappy\Dropbox\IDLWorkspace81\Research\)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="ymd_to_yd.pro (Documentation for C:\Users\Lappy\Dropbox\IDLWorkspace81\Research\)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;   ymd_to_yd.pro</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;   Convert year,month,day arrays into yyyydoy</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;   Library function</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:  </span>
<span class="comments">;   ymd_to_yd, year, month, day, yyyydoy, fracday=fracday, SOD=SOD</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;   year = 4 digit year</span>
<span class="comments">;   month = 1-12 for Jan-Dec</span>
<span class="comments">;   day = 1-31 for day of month </span>
<span class="comments">;         day can be a double (day + fractional day)</span>
<span class="comments">;         The fractional part is ignored if SOD is present.</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL INPUTS:</span>
<span class="comments">;   SOD = seconds of day (overrides fractional part of day)</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:</span>
<span class="comments">;   yyyydoy = year + day of year (long or double array)</span>
<span class="comments">;             The fraction of day is calculated from SOD if available,</span>
<span class="comments">;             otherwise it is calculated from the fractional part of day.</span>
<span class="comments">;</span>
<span class="comments">; COMMON BLOCKS:</span>
<span class="comments">;   ymd_to_yd_lookuptables</span>
<span class="comments">;     doy_table : 2d integer array - DOY is doy_table[day,month]</span>
<span class="comments">;     ldoy_table: same thing but for leap years</span>
<span class="comments">;       These two arrays are 33,13 so that calendar dates can be</span>
<span class="comments">;       directly used. Jan 1 or [1,1] is the lowest useable index,</span>
<span class="comments">;       while Dec 31 or [31,12] is the highest useable index.</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;  1) Check input parameters</span>
<span class="comments">;  2) set default output values</span>
<span class="comments">;  3) Populate lookup tables if needed</span>
<span class="comments">;  4) Retrieve leap_year array</span>
<span class="comments">;  5) Use lookup tables to determine DOY</span>
<span class="comments">;  6) Add DOY to year*1000L</span>
<span class="comments">;  7) Return</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;</span>
<span class="comments">; fractional day is too small to matter</span>
<span class="comments">;  IDL> ymd_to_yd,2002,1,1.00000000000001d,yd</span>
<span class="comments">;  IDL> help,yd</span>
<span class="comments">;  YD              LONG      =      2002001</span>
<span class="comments">;</span>
<span class="comments">; fractional day is now large enough to be detected</span>
<span class="comments">;  IDL> ymd_to_yd,2002,1,1.0000000000001d,yd</span>
<span class="comments">;  IDL> help,yd</span>
<span class="comments">;  YD              DOUBLE    =        2002001.0</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; ROUTINES USED:</span>
<span class="comments">;  LEAP_YEAR: returns 1 (true) if argument is a leap year, else 0 (false) </span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;  2/21/03 Don Woodraska File modified from yd2ymd.pro</span>
<span class="comments">;  2/24/03 Don Woodraska Added keywords SOD (input seconds of day) and</span>
<span class="comments">;  fracday (output fraction of day).</span>
<span class="comments">;  2/26/03 Don Woodraska Removed fracday. yyyydoy can now return day</span>
<span class="comments">;  fraction instead.</span>
<span class="comments">;</span>
<span class="comments">; $Log: ymd_to_yd.pro,v $</span>
<span class="comments">; Revision 8.0  2005/06/15 18:51:22  see_sw</span>
<span class="comments">; commit of version 8.0</span>
<span class="comments">;</span>
<span class="comments">; Revision 8.0  2004/07/20 20:18:37  turkk</span>
<span class="comments">; commit of version 8.0</span>
<span class="comments">;</span>
<span class="comments">; Revision 7.0  2004/07/08 23:03:03  turkk</span>
<span class="comments">; commit of version 7.0</span>
<span class="comments">;</span>
<span class="comments">; Revision 6.1  2003/03/13 01:48:01  dlwoodra</span>
<span class="comments">; initial commit</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;idver='$Id: ymd_to_yd.pro,v 8.0 2005/06/15 18:51:22 see_sw Exp $'</span>
<span class="comments">;</span>
<span class="comments">;-</span>

<a id="ymd_to_yd:source"></a>pro ymd_to_yd, theYear, theMonth, theDay, yyyydoy, SOD=SOD

<span class="comments">; store local lookup tables that only need to be calculated once</span>
common ymd_to_yd_lookuptables,  doy_table, ldoy_table

<span class="comments">;</span>
<span class="comments">;  1)  Check input parameters</span>
<span class="comments">;</span>
if (n_params(0) lt 4) then goto, bailout

n_days = n_elements(theYear)

if n_days ne n_elements(themonth) and $
  n_days ne n_elements(theday) then begin
    print,'ERROR: arrays do not agree in length'
    goto, bailout
endif
x=where((theDay gt 31) or (theDay lt 1),n_x)
if n_x gt 0 then begin
    print,'ERROR: day of month is invalid'
    goto, bailout
endif

<span class="comments">;</span>
<span class="comments">;  2) set default output values</span>
<span class="comments">;</span>
yyyydoy=long(theYear)*1000L
if arg_present(SOD) or size(SOD,/type) ne 0 then begin
        <span class="comments">; then a value for SOD exists, use it</span>
    fracday = SOD / 86400.d0
endif else fracday=double(theDay mod 1L) <span class="comments">; copy day fraction from theDay</span>

<span class="comments">; find if any day fractions are gt the precision of a double</span>
w_frac=where(fracday gt 1.d-14,n_w_frac)
<span class="comments">;if any, change yyyydoy to a double and add it in</span>
if n_w_frac gt 0 then $
  yyyydoy=yyyydoy + fracday <span class="comments">;convert yyyydoy to double</span>

thelongDay=long(theDay) <span class="comments">;index for array lookup</span>

<span class="comments">;</span>
<span class="comments">;  3) Populate lookup tables if needed</span>
<span class="comments">;</span>
if size(dayofmonthidx,/type) eq 0 then begin

    <span class="comments">;  define doy offset arrays</span>
    doy_offset    = [ 0L, 31, 59, 90,120,151,181,212,243,273,304,334,365 ]
    doy_ly_offset = [ 0L, 31, 60, 91,121,152,182,213,244,274,305,335,366 ]

    m31=indgen(31)+1 <span class="comments">;day of month array</span>

    <span class="comments">;  build the array lookup tables for leap and non-leap years</span>
    doy_table=intarr(32,13) &lt<span class="comments">; (-1) ;make a big DOY table by month,dayofmonth</span>
    ldoy_table=doy_table
     <span class="comments">;  january is month 1 (not 0)</span>
     <span class="comments">;  first day of month is 1 (not 0)</span>
    for i=1,12 do begin
        ii = i - 1
         <span class="comments">; non leap years</span>
        lo = i * n_elements(doy_table[*,0]) + 1
         <span class="comments">; lo is scalar start index of 31-element array assignment</span>
        doy_table[lo] =  m31 + doy_offset[ii]
         <span class="comments">; leap years</span>
        llo = i * n_elements(ldoy_table[*,0]) + 1
        ldoy_table[llo] = m31 + doy_ly_offset[ii]
    endfor
endif

<span class="comments">;</span>
<span class="comments">;  4) Retrieve leap_year array</span>
<span class="comments">;</span>
leapYear = leap_year(theYear) <span class="comments">;vector or scalar</span>

if n_days gt 1 then begin
    <span class="comments">; vector part</span>
    leap=where(leapYear eq 1L,n_leap,comp=not_leap,ncomp=n_not_leap)
    doy=lonarr(n_days)
endif else begin
    <span class="comments">; scalar part</span>
    doy=-1L  &  n_not_leap=0L  &  n_leap=0L  &  leap=-1L  &  not_leap=-1L
    if (leapYear eq 1L) then begin
        n_leap=1L      &  leap=0L
    endif else begin
        n_not_leap=1L  &  not_leap=0L
    endelse
endelse

<span class="comments">;</span>
<span class="comments">;  5) Use lookup tables to determine DOY</span>
<span class="comments">;</span>
if n_leap gt 0 then begin
    doy[leap]     = ldoy_table[thelongDay[leap],theMonth[leap]]
endif
if n_not_leap gt 0 then begin
    doy[not_leap] = doy_table[thelongDay[not_leap],theMonth[not_leap]]
endif

<span class="comments">;</span>
<span class="comments">;  6) Add DOY to year*1000L</span>
<span class="comments">;</span>
yyyydoy=yyyydoy+doy

<span class="comments">;</span>
<span class="comments">;  7) Return</span>
<span class="comments">;</span>
return

bailout:
print, ''
print, 'USAGE:  ymd_to_yd, year, month, day, yyyydoy'
print, ''
print, ' inputs'
print, '   year : 4-digit year (ex. 2003)'
print, '   month: 2-digit month number - range is 1-12 (0 is not valid)'
print, '   day  : day of month - range is 1-31 (0 is not valid)'
print, ''
print, ' output'
print, '   yyyydoy : returned value, always a long integer'
print,''
return

end
</code>
    </div>
  </body>
</html>
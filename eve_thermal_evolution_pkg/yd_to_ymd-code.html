<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.4.3 on Thu Jul 05 11:36:30 2012 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>yd_to_ymd.pro (Documentation for C:\Users\Lappy\Dropbox\IDLWorkspace81\Research\)</title>

    
    <link rel="stylesheet" type="text/css" media="all"
          href="../idldoc-resources/main.css" />
    <link rel="stylesheet" type="text/css" media="print"
          href="../idldoc-resources/main-print.css" />
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="yd_to_ymd.pro (Documentation for C:\Users\Lappy\Dropbox\IDLWorkspace81\Research\)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;   yd_to_ymd.pro</span>
<span class="comments">;</span>
<span class="comments">; PURPOSE:</span>
<span class="comments">;   Convert yyyydoy to year-month-day</span>
<span class="comments">;</span>
<span class="comments">; CATEGORY:</span>
<span class="comments">;   Library function</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:  </span>
<span class="comments">;   yd_to_ymd, yyyydoy, year, month, day, sod=sod</span>
<span class="comments">;</span>
<span class="comments">; INPUTS:</span>
<span class="comments">;   yyyydoy = year + day of year (should be a long or double)</span>
<span class="comments">;</span>
<span class="comments">; OUTPUTS:  </span>
<span class="comments">;   year = 4 digit year (long)</span>
<span class="comments">;   month = 1-12 for Jan-Dec (long)</span>
<span class="comments">;   day = 1-31 for day of month (long)</span>
<span class="comments">;</span>
<span class="comments">; OPTIONAL OUTPUTS:</span>
<span class="comments">;   sod = seconds of day (double)</span>
<span class="comments">;</span>
<span class="comments">; COMMON BLOCKS:</span>
<span class="comments">;   yd_to_ymd_lookuptables</span>
<span class="comments">;     dayofmonthidx : day index table accessed by DOY 1-366, intarr(367)</span>
<span class="comments">;     monthidx      : month index table, intarr(367)</span>
<span class="comments">;     ldayofmonthidx: leap year day index table, intarr(367)</span>
<span class="comments">;     lmonthidx     : leap year month index table, intarr(367)</span>
<span class="comments">;</span>
<span class="comments">; PROCEDURE:</span>
<span class="comments">;   1) Set default output values</span>
<span class="comments">;   2) Check input parameters</span>
<span class="comments">;   3) Populate lookup tables if needed</span>
<span class="comments">;   4) Make year array</span>
<span class="comments">;   5) Get leap_year flags</span>
<span class="comments">;   6) Make DOY array</span>
<span class="comments">;   7) Assign month and day using leap year/non leap year indices</span>
<span class="comments">;   8) Return</span>
<span class="comments">;</span>
<span class="comments">; EXAMPLES:</span>
<span class="comments">;</span>
<span class="comments">;  IDL> yd_to_ymd,2002001,y,m,d        </span>
<span class="comments">;  IDL> help,y,m,d    </span>
<span class="comments">;  Y               LONG      =         2002</span>
<span class="comments">;  M               LONG      =            1</span>
<span class="comments">;  D               LONG      =            1</span>
<span class="comments">;</span>
<span class="comments">;  IDL> yd_to_ymd,2002001.1d,y,m,d</span>
<span class="comments">;  IDL> help,y,m,d</span>
<span class="comments">;  Y               LONG      =         2002</span>
<span class="comments">;  M               LONG      =            1</span>
<span class="comments">;  D               DOUBLE    =        1.1000000</span>
<span class="comments">;</span>
<span class="comments">;  IDL> yd_to_ymd,2002001.1d,y,m,d,sod=sod</span>
<span class="comments">;  IDL> help,y,m,d,sod</span>
<span class="comments">;  Y               LONG      =         2002</span>
<span class="comments">;  M               LONG      =            1</span>
<span class="comments">;  D               LONG      =            1</span>
<span class="comments">;  SOD             DOUBLE    =        8640.0000</span>
<span class="comments">;</span>
<span class="comments">; ROUTINES_USED:</span>
<span class="comments">;  LEAP_YEAR: returns 1 for a leap year, 0 otherwise</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">;  2/21/03 Don Woodraska File modified from yyyydoy2ymd.pro</span>
<span class="comments">;  2/24/03 Don Woodraska Modified to convert fractional yyyydoy to sod</span>
<span class="comments">;  seconds of day.</span>
<span class="comments">;</span>
<span class="comments">; $Log: yd_to_ymd.pro,v $</span>
<span class="comments">; Revision 8.0  2005/06/15 18:51:22  see_sw</span>
<span class="comments">; commit of version 8.0</span>
<span class="comments">;</span>
<span class="comments">; Revision 8.0  2004/07/20 20:18:37  turkk</span>
<span class="comments">; commit of version 8.0</span>
<span class="comments">;</span>
<span class="comments">; Revision 7.0  2004/07/08 23:03:02  turkk</span>
<span class="comments">; commit of version 7.0</span>
<span class="comments">;</span>
<span class="comments">; Revision 6.1  2003/03/13 01:48:00  dlwoodra</span>
<span class="comments">; initial commit</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;idver='$Id: yd_to_ymd.pro,v 8.0 2005/06/15 18:51:22 see_sw Exp $'</span>
<span class="comments">;</span>
<span class="comments">;-</span>

<a id="yd_to_ymd:source"></a>pro yd_to_ymd, yyyydoy, theYear, theMonth, theDay, sod=sod

<span class="comments">; store local lookup tables so they are calculated only once</span>
common yd_to_ymd_lookuptables, dayofmonthidx,monthidx,ldayofmonthidx,lmonthidx

<span class="comments">;</span>
<span class="comments">;  1) Set default output values</span>
<span class="comments">;</span>
theYear = -1L  &  theMonth = -1L  &  theDay = -1L  &  sod = -1.d0

<span class="comments">;</span>
<span class="comments">;  2)  Check input parameters</span>
<span class="comments">;</span>
if (n_params() lt 2 or n_params() gt 4) then goto, bailout

<span class="comments">;</span>
<span class="comments">;  3) Populate lookup tables if needed</span>
<span class="comments">;</span>
if size(dayofmonthidx,/type) eq 0 then begin

    <span class="comments">;  define day arrays for quick calculation</span>
    doy_offset    = [ 0L, 31, 59, 90,120,151,181,212,243,273,304,334,365 ]
    doy_ly_offset = [ 0L, 31, 60, 91,121,152,182,213,244,274,305,335,366 ]

    <span class="comments">;build the array lookup tables</span>
    dayofmonthidx  = intarr(367) &lt<span class="comments">; (-1)  &  monthidx  = dayofmonthidx</span>
    ldayofmonthidx = dayofmonthidx       &  lmonthidx = dayofmonthidx
    m31=indgen(31)+1            <span class="comments">;day of month array</span>
    i31=intarr(31)              <span class="comments">;filler of zeroes for month assignment</span>
    for i=1,12 do begin
        ii = i - 1
         <span class="comments">; non leap years</span>
        lo                = 1 + doy_offset[ii]
        dayofmonthidx[lo] = m31
         <span class="comments">; lo is the start array index of the 31-element array assignment</span>
        monthidx[lo]      = i + i31
         <span class="comments">; leap years</span>
        llo                 = 1 + doy_ly_offset[ii]
        ldayofmonthidx[llo] = m31
        lmonthidx[llo]      = i + i31
    endfor
endif

<span class="comments">;</span>
<span class="comments">;  4) Make year array</span>
<span class="comments">;</span>
theYear = long( yyyydoy/1000L )

<span class="comments">;</span>
<span class="comments">;  5) Get leap_year flags</span>
<span class="comments">;</span>
leapYear = leap_year(theYear) <span class="comments">;vector or scalar</span>

<span class="comments">;</span>
<span class="comments">;  6) Make DOY array</span>
<span class="comments">;</span>
DOY    = long( yyyydoy mod 1000L )
n_days = n_elements(DOY)
if arg_present(sod) then flagsod=0 else flagsod=1
sod    = double(yyyydoy mod 1.d0) * 86400.d0

if n_days gt 1 then begin
    <span class="comments">; vector part</span>
    theMonth = lonarr(n_days)  &  theDay = theMonth
    leap=where(leapYear eq 1L,n_leap,comp=not_leap,ncomp=n_not_leap)
endif else begin
    <span class="comments">; scalar part</span>
    n_not_leap=0L  &  n_leap=0L  &  not_leap=-1L  &  leap=-1L
    if (leapYear eq 1L) then begin
        n_leap=1L      &  leap=0L
    endif else begin
        n_not_leap=1L  &  not_leap=0L
    endelse
endelse

<span class="comments">;</span>
<span class="comments">;  7) Assign month and day using leap year/non leap year indices</span>
<span class="comments">;</span>
if n_leap gt 0 then begin
    theMonth[leap] = lmonthidx[DOY[leap]]
    theDay[leap]   = ldayofmonthidx[DOY[leap]]
endif
if n_not_leap gt 0 then begin
    theMonth[not_leap] = monthidx[DOY[not_leap]]
    theDay[not_leap]   = dayofmonthidx[DOY[not_leap]]
endif

<span class="comments">; if sod not present on command line and sod is valid, append day</span>
<span class="comments">; fraction to theDay (and make it a double)</span>
valid_sod=where(sod gt 1d-14,n_valid_sod)
if flagsod eq 1 and n_valid_sod gt 0 then $
  theDay=theDay+(double(yyyydoy mod 1.d))

<span class="comments">;</span>
<span class="comments">;  8) Return</span>
<span class="comments">;</span>
return

bailout:
print,''
print, 'USAGE:  yd_to_ymd, yyyydoy, year, month, day, sod=sod'
print, ''
print, ' input'
print, '   yyyydoy : 7-digit year and day of year (2002365 is Dec 31,2002)'
print,''
print, ' outputs'
print, '   year : 4-digit year (ex. 2002)'
print, '   month: 2-digit month number - range is 1-12 (0 is not valid)'
print, '   day  : day of month - range is 1-31 (0 is not valid)'
print, '   sod  : seconds of day - range is 0-86399.99999'
print,''
return
end
</code>
    </div>
  </body>
</html>